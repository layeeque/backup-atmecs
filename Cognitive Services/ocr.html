<!DOCTYPE html>
<html>

<head>
    <title>OCR Sample</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>

<body>

    <script type="text/javascript">
        function processImage() {
            // **********************************************
            // *** Update or verify the following values. ***
            // **********************************************

            // Replace the subscriptionKey string value with your valid subscription key.
            var subscriptionKey = "678748e57e774f92a9e1fde09531ee65";

            // Replace or verify the region.
            //
            // You must use the same region in your REST API call as you used to obtain your subscription keys.
            // For example, if you obtained your subscription keys from the westus region, replace
            // "westcentralus" in the URI below with "westus".
            //
            // NOTE: Free trial subscription keys are generated in the westcentralus region, so if you are using
            // a free trial subscription key, you should not need to change this region.
            var uriBase = "https://westcentralus.api.cognitive.microsoft.com/vision/v1.0/ocr";

            // Request parameters.
            var params = {
                "language": "unk",
                "detectOrientation ": "true",
            };

            // Display the image.
            var sourceImageUrl = document.getElementById("inputImage").value;
            document.querySelector("#sourceImage").src = sourceImageUrl;

            // Perform the REST API call.
            $.ajax({
                url: uriBase + "?" + $.param(params),

                // Request headers.
                beforeSend: function (jqXHR) {
                    jqXHR.setRequestHeader("Content-Type", "application/json");
                    jqXHR.setRequestHeader("Ocp-Apim-Subscription-Key", subscriptionKey);
                },

                type: "POST",

                // Request body.
                data: '{"url": ' + '"' + sourceImageUrl + '"}',
            })

                .done(function (body) {
                    // var i = 0;
                    // var datam = []
                    // // Show formatted JSON on webpage.
                    // console.log(JSON.stringify(data));
                    // //console.log(JSON.parse(data))
                    // console.log("total length is "+Object.keys(data.regions[0].lines).length)
                    // for(var i=0;i<Object.keys(data.regions[0].lines).length;i++)
                    // {
                    //     var j=0;
                    //     if(Object.keys(data.regions[0].lines[i].words[j]).length!=0)
                    //     {
                    //         console.log(Object.keys(data.regions[0].lines[i].words[j]).length)
                    //     }
                    //     else{ console.log("true")}
                    //         //console.log("i= "+i)
                    // }
                    // for (var key in data && key=="text") {
                    //     if (data.hasOwnProperty(key)) {
                    //         datam[i] = obj[key];
                    //         i++

                    //     }
                    // }

                    //=================================================================
                    console.log(JSON.stringify(body));
                    var i = 0;
                    //var datam = ""
                    var datam = ""
                    var k = 0
                    // Show formatted JSON on webpage.
                    //console.log(JSON.stringify(body));
                    //console.log(JSON.parse(data))
                    for (var key in body) {
                        console.log("hello")

                        if (body.hasOwnProperty(key) && (Object.keys(body.regions[0].lines[i].words).length) != 0) {
                            console.log("length of line is " + Object.keys(body.regions[0].lines[i].words).length)

                            for (var j = 0; j < Object.keys(body.regions[0].lines[i].words).length; j++) {

                                datam = datam + body.regions[0].lines[i].words[j].text + " "
                                //datam[k++] = body.regions[0].lines[i].words[j].text + " "
                                console.log(datam);
                            }

                        }
                        i++
                    }

                    $("#responseTextArea").val(datam);
                })

                .fail(function (jqXHR, textStatus, errorThrown) {
                    // Display error message.
                    var errorString = (errorThrown === "") ? "Error. " : errorThrown + " (" + jqXHR.status + "): ";
                    errorString += (jqXHR.responseText === "") ? "" : (jQuery.parseJSON(jqXHR.responseText).message) ?
                        jQuery.parseJSON(jqXHR.responseText).message : jQuery.parseJSON(jqXHR.responseText).error.message;
                    alert(errorString);
                });
        };
    </script>

    <h1>Optical Character Recognition (OCR):</h1>
    Enter the URL to an image of printed text, then click the
    <strong>Read image</strong> button.
    <br>
    <br> Image to read:
    <input type="text" name="inputImage" id="inputImage" value="https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/Atomist_quote_from_Democritus.png/338px-Atomist_quote_from_Democritus.png"
    />
    <button onclick="processImage()">Read image</button>
    <br>
    <br>
    <div id="wrapper" style="width:1020px; display:table;">
        <div id="jsonOutput" style="width:600px; display:table-cell;">
            Response:
            <br>
            <br>
            <textarea id="responseTextArea" class="UIInput" style="width:580px; height:400px;"></textarea>
        </div>
        <div id="imageDiv" style="width:420px; display:table-cell;">
            Source image:
            <br>
            <br>
            <img id="sourceImage" width="400" />
        </div>
    </div>
</body>

</html>